<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Acervo de Filmes</title>
    <link href="https://fonts.googleapis.com/css2?family=Josefin+Sans:wght@300;400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="header">
        <div class="header-content">
            <div class="filter-buttons">
                <button class="filter-btn active" onclick="filterMovies('popular')">Populares</button>
                <button class="filter-btn" onclick="filterMovies('top_rated')">Mais Bem Avaliados</button>
            </div>
            
            <div class="search-container">
                <input type="text" class="search-input" placeholder="Buscar filme..." id="searchInput">
                <button class="search-btn" onclick="searchMovies()"><img src="/imgs/lupa.png" alt="" style="width: 1em"></button>
            </div>
        </div>
    </div>

    <div class="main-title">
        <div class="title-box">
            Acervo de Filmes
        </div>
    </div>

    <div class="movies-container">
        <div class="loading" id="loading">Carregando filmes...</div>
        <div class="error-message" id="errorMessage"></div>
        <div class="no-results" id="noResults">Nenhum filme encontrado.</div>
        
        <div class="movies-grid" id="moviesGrid"></div>
    </div>

    <div class="pagination-container" id="paginationContainer" style="display: none;">
        <div class="pagination">
            <button class="page-btn" id="prevBtn" onclick="changePage(-1)">❮ Anterior</button>
            <div class="page-info">
                <span>Página <span id="currentPageSpan">1</span> de <span id="totalPagesSpan">1</span></span>
            </div>
            <button class="page-btn" id="nextBtn" onclick="changePage(1)">Próxima ❯</button>
        </div>
    </div>

    <div class="footer"></div>

    <script>
        let currentPage = 1;
        let totalPages = 1;
        let currentFilter = 'popular';
        let currentSearchTerm = '';

        const API_KEY = '2e9fc863db067705b66461eb2f5eaa7f';
        const BASE_URL = 'https://api.themoviedb.org/3';
        const IMAGE_BASE_URL = 'https://image.tmdb.org/t/p/w300';

        window.addEventListener('DOMContentLoaded', () => {
            loadMovies();
        });

        document.getElementById('searchInput').addEventListener('keypress', (e) => {
            if (e.key === 'Enter') {
                searchMovies();
            }
        });

        async function loadMovies(page = 1) {
            showLoading(true);
            currentPage = page;
            
            try {
                let endpoint;
                if (currentSearchTerm) {
                    endpoint = `${BASE_URL}/search/movie?api_key=${API_KEY}&language=pt-BR&query=${encodeURIComponent(currentSearchTerm)}&page=${page}`;
                } else {
                    endpoint = `${BASE_URL}/movie/${currentFilter}?api_key=${API_KEY}&language=pt-BR&page=${page}`;
                }
                
                const response = await fetch(endpoint);
                
                if (!response.ok) {
                    throw new Error(`Erro na API: ${response.status}`);
                }
                
                const data = await response.json();
                totalPages = Math.min(data.total_pages, 500); 
                
                if (data.results.length === 0 && page === 1) {
                    showNoResults(true);
                    clearMovies();
                    hidePagination();
                } else {
                    displayMovies(data.results);
                    updatePagination();
                    showPagination();
                }
            } catch (error) {
                showError('Erro ao carregar filmes. Verifique sua chave da API.');
                console.error('Erro:', error);
                hidePagination();
            } finally {
                showLoading(false);
            }
        }

        function filterMovies(filter) {
            document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            currentFilter = filter;
            currentSearchTerm = '';
            currentPage = 1;
            document.getElementById('searchInput').value = '';
            
            loadMovies(1);
        }

        async function searchMovies() {
            const searchTerm = document.getElementById('searchInput').value.trim();
            
            currentSearchTerm = searchTerm;
            currentPage = 1;
            
            if (searchTerm) {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
            } else {
                document.querySelectorAll('.filter-btn').forEach(btn => btn.classList.remove('active'));
                document.querySelector('.filter-btn').classList.add('active');
                currentFilter = 'popular';
            }
            
            loadMovies(1);
        }

        function changePage(direction) {
            const newPage = currentPage + direction;
            if (newPage >= 1 && newPage <= totalPages) {
                loadMovies(newPage);
                window.scrollTo({ top: 0, behavior: 'smooth' });
            }
        }

        function updatePagination() {
            document.getElementById('currentPageSpan').textContent = currentPage;
            document.getElementById('totalPagesSpan').textContent = totalPages;
            
            const prevBtn = document.getElementById('prevBtn');
            const nextBtn = document.getElementById('nextBtn');
            
            prevBtn.disabled = currentPage <= 1;
            nextBtn.disabled = currentPage >= totalPages;
        }

        function showPagination() {
            document.getElementById('paginationContainer').style.display = 'block';
        }

        function hidePagination() {
            document.getElementById('paginationContainer').style.display = 'none';
        }

        function displayMovies(movies) {
            const moviesGrid = document.getElementById('moviesGrid');
            hideMessages();
            
            moviesGrid.innerHTML = movies.map(movie => createMovieCard(movie)).join('');
        }

        function createMovieCard(movie) {
            const posterPath = movie.poster_path 
                ? `${IMAGE_BASE_URL}${movie.poster_path}` 
                : null;
            
            const year = movie.release_date 
                ? new Date(movie.release_date).getFullYear() 
                : '';
            
            const rating = movie.vote_average 
                ? `★ ${movie.vote_average.toFixed(1)}` 
                : '';

            return `
                <div class="movie-card" onclick="showMovieDetails(${movie.id})">
                    <div class="movie-poster">
                        ${posterPath 
                            ? `<img src="${posterPath}" alt="${movie.title}" onerror="this.parentElement.innerHTML='Sem imagem'">` 
                            : 'Sem imagem'
                        }
                    </div>
                    <div class="movie-info">
                        <div class="movie-title">${movie.title}</div>
                        ${year ? `<div class="movie-year">${year}</div>` : ''}
                        ${rating ? `<div class="movie-rating">${rating}</div>` : ''}
                    </div>
                </div>
            `;
        }

        function showMovieDetails(movieId) {
            alert(`Detalhes do filme (ID: ${movieId})\n\nImplementar modal de detalhes aqui!`);
        }

        function showLoading(show) {
            document.getElementById('loading').style.display = show ? 'block' : 'none';
        }

        function showError(message) {
            const errorElement = document.getElementById('errorMessage');
            errorElement.textContent = message;
            errorElement.style.display = 'block';
        }

        function showNoResults(show) {
            document.getElementById('noResults').style.display = show ? 'block' : 'none';
        }

        function hideMessages() {
            document.getElementById('errorMessage').style.display = 'none';
            document.getElementById('noResults').style.display = 'none';
        }

        function clearMovies() {
            document.getElementById('moviesGrid').innerHTML = '';
        }
    </script>
</body>

</html>
